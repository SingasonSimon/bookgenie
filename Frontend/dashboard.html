<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - BookGenie</title>
    <link rel="stylesheet" href="css/dashboard.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav">
            <div class="logo">
                <span>BookGenie</span>
            </div>
            <div class="nav-links">
                <a href="#" class="nav-link active" onclick="switchTab('dashboard')">Dashboard</a>
                <a href="#" class="nav-link" onclick="switchTab('search')">Search</a>
                <a href="#" class="nav-link" onclick="switchTab('categories')">Categories</a>
                <a href="#" class="nav-link" onclick="switchTab('subscription')" id="subscriptionTab" style="display: none;">Subscription</a>
                <div id="adminNav" style="display: none;">
                    <a href="#" class="nav-link" onclick="switchTab('users')">Users</a>
                    <a href="#" class="nav-link" onclick="switchTab('analytics')">Analytics</a>
                    <a href="#" class="nav-link" onclick="switchTab('books')">Manage Books</a>
                </div>
            </div>
            <div class="user-menu">
                <div class="user-avatar" onclick="toggleProfileDropdown()">User</div>
                <span id="userName" style="font-weight: 500;" onclick="toggleProfileDropdown()">User</span>
                <div class="user-profile-dropdown" id="userProfileDropdown">
                    <div class="profile-header">
                        <div class="profile-avatar" id="profileAvatar">User</div>
                        <div class="profile-info">
                            <h4 id="profileName">User Name</h4>
                            <div class="role-badge" id="profileRole">Student</div>
                        </div>
                    </div>
                    <div class="profile-details">
                        <div class="profile-detail">
                            <span class="label">Email:</span>
                            <span class="value" id="profileEmail">user@email.com</span>
                        </div>
                        <div class="profile-detail">
                            <span class="label">Subscription:</span>
                            <span class="value">
                                <span class="subscription-badge" id="profileSubscription">Free</span>
                            </span>
                        </div>
                        <div class="profile-detail">
                            <span class="label">Department:</span>
                            <span class="value" id="profileDepartment">Computer Science</span>
                        </div>
                        <div class="profile-detail">
                            <span class="label">Member since:</span>
                            <span class="value" id="profileJoinDate">2024</span>
                        </div>
                    </div>
                    <div class="profile-actions">
                        <button class="profile-btn" onclick="switchTab('subscription'); toggleProfileDropdown();">Upgrade Plan</button>
                        <button class="profile-btn" onclick="showFeedbackModal(); toggleProfileDropdown();">Give Feedback</button>
                        <button class="profile-btn logout" onclick="logout()">Logout</button>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Messages -->
        <div id="message" class="message"></div>

        <!-- Tab Navigation -->
        <div class="tab-navigation" id="tabNavigation">
            <button class="tab active" onclick="switchTab('dashboard')">Dashboard</button>
            <button class="tab" onclick="switchTab('search')">Search Books</button>
            <button class="tab" onclick="switchTab('categories')">Categories</button>
            <button class="tab" onclick="switchTab('subscription')" id="subscriptionTabBtn" style="display: none;">Subscription</button>
            <button class="tab" onclick="switchTab('users')" id="usersTabBtn" style="display: none;">Manage Users</button>
            <button class="tab" onclick="switchTab('analytics')" id="analyticsTabBtn" style="display: none;">Analytics</button>
            <button class="tab" onclick="switchTab('books')" id="booksTabBtn" style="display: none;">Manage Books</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboardTab" class="tab-content active">
            <div class="dashboard-section">
                <div class="section-header">
                    <h2 class="section-title" id="dashboardTitle">Your Reading Dashboard</h2>
                    <button class="search-btn" onclick="showFeedbackModal()">Give Feedback</button>
                </div>
                <div class="stats-grid" id="userStats">
                    <!-- Stats will be loaded here -->
                </div>
                <div id="recommendedBooksSection">
                    <!-- Recommended books will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Search Tab -->
        <div id="searchTab" class="tab-content">
            <div class="search-section">
                <div class="search-container">
                    <input type="text" id="searchInput" class="search-input" placeholder="Search for books, authors, topics..." />
                    <button class="search-btn" onclick="performSearch()">Search</button>
                </div>
                <div class="filters">
                    <select class="filter-select" id="genreFilter">
                        <option value="">All Genres</option>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Environmental Science">Environmental Science</option>
                        <option value="Economics">Economics</option>
                        <option value="Physics">Physics</option>
                        <option value="Social Sciences">Social Sciences</option>
                    </select>
                    <select class="filter-select" id="levelFilter">
                        <option value="">All Levels</option>
                        <option value="undergraduate">Undergraduate</option>
                        <option value="postgraduate">Postgraduate</option>
                        <option value="faculty">Faculty</option>
                    </select>
                </div>
            </div>
            <div class="dashboard-section" id="searchResults" style="display: none;">
                <div class="section-header">
                    <h2 class="section-title">Search Results</h2>
                    <span class="relevance-badge" id="resultsCount">0 results</span>
                </div>
                <div class="results-grid" id="searchResultsGrid">
                    <!-- Search results will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Categories Tab -->
        <div id="categoriesTab" class="tab-content">
            <div class="dashboard-section">
                <div class="section-header">
                    <h2 class="section-title">Book Categories</h2>
                </div>
                <div class="results-grid" id="categoriesGrid">
                    <!-- Categories will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Users Tab (Admin Only) -->
        <div id="usersTab" class="tab-content admin-section">
            <div class="dashboard-section">
                <div class="section-header">
                    <h2 class="section-title">User Management</h2>
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <span class="relevance-badge" id="totalUsersCount">0 Users</span>
                        <button class="search-btn" onclick="showSubscriptionRequestsModal()">Subscription Requests</button>
                    </div>
                </div>
                
                <div class="users-grid" id="usersGrid">
                    <!-- Users will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Analytics Tab (Admin Only) -->
        <div id="analyticsTab" class="tab-content admin-section">
            <div class="dashboard-section">
                <div class="section-header">
                    <h2 class="section-title">System Analytics</h2>
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <span class="relevance-badge">Real-time Data</span>
                        <button class="search-btn" onclick="showSubscriptionRequestsModal()">View Subscription Requests</button>
                    </div>
                </div>
                <div id="analyticsContent">
                    <!-- Analytics will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Books Management Tab (Admin Only) -->
        <div id="booksTab" class="tab-content admin-section">
            <div class="dashboard-section">
                <div class="section-header">
                    <h2 class="section-title">Manage Books</h2>
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <input type="text" id="bookSearchInput" class="form-input" placeholder="Search books..." 
                               style="width: 300px; padding: 0.5rem;" onkeyup="filterAdminBooks()">
                        <button class="search-btn" onclick="showAddBookModal()">Add New Book</button>
                    </div>
                </div>
                <div class="results-grid" id="booksGrid">
                    <!-- Books will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Subscription Tab -->
        <div id="subscriptionTab" class="tab-content">
            <div class="dashboard-section">
                <div class="section-header">
                    <h2 class="section-title">Subscription Plans</h2>
                    <div class="subscription-badge" id="currentSubscriptionBadge">Free</div>
                </div>
                
                <div class="subscription-plans" id="subscriptionPlansContainer">
                    <!-- Subscription plans will be loaded here -->
                </div>
                
                <!-- Subscription Request History -->
                <div class="dashboard-section" style="margin-top: 2rem;">
                    <div class="section-header">
                        <h2 class="section-title">Your Subscription History</h2>
                    </div>
                    <div id="subscriptionHistory">
                        <!-- Subscription history will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- User Profile Modal -->
        <div id="userProfileModal" class="modal user-profile-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">User Profile</h3>
                    <button class="close-btn" onclick="closeUserProfile()">Close</button>
                </div>
                <div id="userProfileContent">
                    <!-- User profile content will be loaded here -->
                </div>
            </div>
        </div>

        <!-- User Traffic Modal -->
        <div id="userTrafficModal" class="modal user-profile-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">User Traffic Analytics</h3>
                    <button class="close-btn" onclick="closeUserTraffic()">Close</button>
                </div>
                <div id="userTrafficContent">
                    <!-- User traffic content will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Edit User Modal -->
        <div id="editUserModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Edit User</h3>
                    <button class="close-btn" onclick="closeEditUserModal()">Close</button>
                </div>
                <form id="editUserForm" onsubmit="updateUser(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">First Name</label>
                            <input type="text" class="form-input" id="editFirstName" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Last Name</label>
                            <input type="text" class="form-input" id="editLastName" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="editEmail" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Academic Level</label>
                            <select class="form-select" id="editAcademicLevel">
                                <option value="">Select Level</option>
                                <option value="undergraduate">Undergraduate</option>
                                <option value="postgraduate">Postgraduate</option>
                                <option value="faculty">Faculty</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Department</label>
                            <input type="text" class="form-input" id="editDepartment">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Role</label>
                            <select class="form-select" id="editRole">
                                <option value="student">Student</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Subscription Level</label>
                            <select class="form-select" id="editSubscriptionLevel">
                                <option value="free">Free</option>
                                <option value="basic">Basic</option>
                                <option value="premium">Premium</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn" onclick="closeEditUserModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Update User</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Subscription Requests Modal -->
        <div id="subscriptionRequestsModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Pending Subscription Requests</h3>
                    <button class="close-btn" onclick="closeSubscriptionRequestsModal()">Close</button>
                </div>
                <div id="subscriptionRequestsContent">
                    <!-- Subscription requests will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Feedback Modal -->
        <div id="feedbackModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Share Your Feedback</h3>
                    <button class="close-btn" onclick="closeFeedbackModal()">Close</button>
                </div>
                <form id="feedbackForm" onsubmit="submitFeedback(event)">
                    <div class="form-group">
                        <label class="form-label">How would you rate your experience?</label>
                        <div class="rating-stars" id="ratingStars">
                            <span class="star" data-rating="1" onclick="setRating(1)">★</span>
                            <span class="star" data-rating="2" onclick="setRating(2)">★</span>
                            <span class="star" data-rating="3" onclick="setRating(3)">★</span>
                            <span class="star" data-rating="4" onclick="setRating(4)">★</span>
                            <span class="star" data-rating="5" onclick="setRating(5)">★</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Your Feedback</label>
                        <textarea class="form-textarea" id="feedbackMessage" placeholder="Tell us about your experience with BookGenie..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Feedback Type</label>
                        <select class="form-select" id="feedbackType">
                            <option value="general">General Feedback</option>
                            <option value="feature_request">Feature Request</option>
                            <option value="bug_report">Bug Report</option>
                            <option value="improvement">Improvement Suggestion</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn" onclick="closeFeedbackModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Submit Feedback</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Book Modal (Admin Only) -->
        <div id="addBookModal" class="modal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h3 class="modal-title">Add New Book</h3>
                    <button class="close-btn" onclick="closeAddBookModal()">×</button>
                </div>
                <form id="addBookForm" onsubmit="addNewBook(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Book Title *</label>
                            <input type="text" class="form-input" id="bookTitle" required placeholder="Enter book title">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Author *</label>
                            <input type="text" class="form-input" id="bookAuthor" required placeholder="Enter author name">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Abstract *</label>
                        <textarea class="form-textarea" id="bookAbstract" required rows="4" placeholder="Enter book abstract or description"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Genre *</label>
                            <select class="form-select" id="bookGenre" required>
                                <option value="">Select Genre</option>
                                <option value="Computer Science">Computer Science</option>
                                <option value="Environmental Science">Environmental Science</option>
                                <option value="Economics">Economics</option>
                                <option value="Physics">Physics</option>
                                <option value="Social Sciences">Social Sciences</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Academic Level *</label>
                            <select class="form-select" id="bookAcademicLevel" required>
                                <option value="">Select Level</option>
                                <option value="undergraduate">Undergraduate</option>
                                <option value="postgraduate">Postgraduate</option>
                                <option value="phd">PhD</option>
                                <option value="faculty">Faculty</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Subscription Level *</label>
                            <select class="form-select" id="bookSubscriptionLevel" required>
                                <option value="free">Free</option>
                                <option value="basic">Basic</option>
                                <option value="premium">Premium</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Pages</label>
                            <input type="number" class="form-input" id="bookPages" min="0" placeholder="Number of pages">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tags (comma separated)</label>
                        <input type="text" class="form-input" id="bookTags" placeholder="machine learning, algorithms, data science">
                        <small class="form-hint">Separate multiple tags with commas</small>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn" onclick="closeAddBookModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add Book</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Edit Book Modal (Admin Only) -->
        <div id="editBookModal" class="modal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h3 class="modal-title">Edit Book</h3>
                    <button class="close-btn" onclick="closeEditBookModal()">×</button>
                </div>
                <form id="editBookForm" onsubmit="updateBook(event)">
                    <input type="hidden" id="editBookId">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Book Title *</label>
                            <input type="text" class="form-input" id="editBookTitle" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Author *</label>
                            <input type="text" class="form-input" id="editBookAuthor" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Abstract *</label>
                        <textarea class="form-textarea" id="editBookAbstract" required rows="4"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Genre *</label>
                            <select class="form-select" id="editBookGenre" required>
                                <option value="">Select Genre</option>
                                <option value="Computer Science">Computer Science</option>
                                <option value="Environmental Science">Environmental Science</option>
                                <option value="Economics">Economics</option>
                                <option value="Physics">Physics</option>
                                <option value="Social Sciences">Social Sciences</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Academic Level *</label>
                            <select class="form-select" id="editBookAcademicLevel" required>
                                <option value="">Select Level</option>
                                <option value="undergraduate">Undergraduate</option>
                                <option value="postgraduate">Postgraduate</option>
                                <option value="phd">PhD</option>
                                <option value="faculty">Faculty</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Subscription Level *</label>
                            <select class="form-select" id="editBookSubscriptionLevel" required>
                                <option value="free">Free</option>
                                <option value="basic">Basic</option>
                                <option value="premium">Premium</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Pages</label>
                            <input type="number" class="form-input" id="editBookPages" min="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tags (comma separated)</label>
                        <input type="text" class="form-input" id="editBookTags" placeholder="machine learning, algorithms">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn" onclick="closeEditBookModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Update Book</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="js/dashboard.js"></script>
</body>
</html>